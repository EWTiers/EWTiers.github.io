<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>E…¥·¥† èW·¥è Ä ü·¥Ö-T…™·¥á Äs</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="style.css"/>
  <style>
    body {
      background: url('ezzzzz.png') no-repeat center center fixed, #181818;
      background-size: cover;
    }
    .game-tab-content { display:none; }
    .game-tab-content.active { display:block; }
    .sidebar-info-btn {
      position: fixed;
      top: 90px;
      left: 17px;
      z-index: 1200;
      width: 52px; height: 52px;
      border-radius: 50%;
      background: #22304ae0;
      color: #fac063;
      font-size: 2.6em;
      font-family: 'Arial Black', Arial, sans-serif;
      text-align: center;
      line-height: 52px;
      letter-spacing: 0.04em;
      box-shadow: 0 2px 14px #4ecdc488;
      cursor: pointer;
      transition: background 0.15s, color 0.22s, box-shadow 0.18s, transform 0.18s;
      border: 2px solid #4ecdc4cc;
      font-weight: bold;
    }
    .sidebar-info-btn:hover {
      background: #4ecdc4e0;
      color: #22304a;
      box-shadow: 0 7px 25px #fac06355;
      transform: scale(1.09) rotate(-3deg);
      border-color: #fac063;
    }
    .sidebar-info-panel {
      position: fixed;
      top: 76px;
      left: 18px;
      width: 340px;
      max-width: 90vw;
      background: rgba(25,26,46,0.98);
      color: #fff;
      border-radius: 18px;
      border: 2.5px solid #4ecdc4;
      box-shadow: 0 8px 35px #162b4a70;
      padding: 24px 25px 18px 25px;
      z-index: 1300;
      display: none;
      font-size: 1.15em;
      animation: fadeIn .23s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px);}
      to { opacity: 1;  transform: none;}
    }
    .info-panel-header {
      font-weight: bold;
      font-size: 1.19em;
      margin-bottom: 8px;
      display: flex; justify-content: space-between; align-items:center;
    }
    .close-info-btn {
      background: none;
      border: none;
      color: #ed7a7a;
      font-size: 1.65em;
      cursor: pointer;
      margin-left: 14px;
      font-weight: bold;
      transition: color 0.18s;
    }
    .close-info-btn:hover { color: #ff5252; }
    .ht-demo, .lt-demo {
      display: inline-block;
      font-weight: bold;
      padding: 2px 13px 2px 13px;
      border-radius: 13px;
      margin: 1px 8px 0 2px;
      font-size: 1em;
    }
    .ht-demo {
      background: linear-gradient(90deg, #00e1ff 0%, #0072ff 100%);
      color: #fff; border: 2px solid #00e1ff;
    }
    .lt-demo {
      background: linear-gradient(90deg, #ffb347 0%, #ff5e62 100%);
      color: #fff; border: 2px solid #ffb347;
    }
    .copyright {
      position: fixed;
      bottom: 20px;
      right: 30px;
      font-size: 0.93rem;
      color: #aeb3d3;
      background: rgba(34, 48, 74, 0.8);
      padding: 8px 15px;
      border-radius: 20px;
      border: 1px solid rgba(78, 205, 196, 0.3);
      backdrop-filter: blur(10px);
      font-weight: 500;
      z-index: 1001;
      transition: all 0.3s ease;
    }
    .copyright:hover {
      color: #4ecdc4;
      border-color: #4ecdc4;
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.2);
    }
    .visitor-counter {
      position: fixed;
      bottom: 20px;
      left: 30px;
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(34, 48, 74, 0.8);
      padding: 8px 15px;
      border-radius: 20px;
      border: 1px solid rgba(78, 205, 196, 0.3);
      backdrop-filter: blur(10px);
      color: #aeb3d3;
      font-size: 0.93rem;
      font-weight: 500;
      z-index: 1001;
      transition: all 0.3s ease;
    }
    .visitor-counter:hover {
      color: #4ecdc4;
      border-color: #4ecdc4;
      box-shadow: 0 4px 15px rgba(78, 205, 196, 0.2);
    }
    .visitor-icon {
      font-size: 1.1em;
    }
    #visitor-count {
      font-weight: bold;
      color: #4ecdc4;
      transition: transform 0.2s ease;
    }
    .visitor-counter:hover #visitor-count {
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div class="top-left-info">
    <span class="server-address" id="copy-address">play.envyworld.gg</span>
  </div>
  <div class="top-right-controls">
    <span id="auth-indicator"><span class="dot"></span> –ì–æ—Å—Ç—å</span>
    <button id="auth-btn" onclick="showAuthModal()">–í–æ–π—Ç–∏</button>
  </div>
  <div id="auth-modal" class="modal" style="display:none">
    <div class="modal-content">
      <h2><span class="lock-ico">üîí</span>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
      <input type="password" id="auth-password" placeholder="–ü–∞—Ä–æ–ª—å"/>
      <button id="auth-enter-btn" onclick="checkPassword()">–í–æ–π—Ç–∏</button>
      <div id="auth-error" class="error-message"></div>
    </div>
  </div>
  <div class="site-version">.version 0.1.4</div>
  <div class="sidebar-info-btn" id="show-info-btn" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è">!</div>
  <div class="sidebar-info-panel" id="info-panel">
    <div class="info-panel-content">
      <div class="info-panel-header">
        <span>–ß—Ç–æ —Ç–∞–∫–æ–µ –¢–∏—Ä–¢–µ—Å—Ç?</span>
        <button id="close-info-btn" class="close-info-btn">&times;</button>
      </div>
      <p><b>–¢–∏—Ä–¢–µ—Å—Ç</b> ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ —Å–∏–ª—ã –∏–≥—Ä–æ–∫–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.<br>
      –ß–µ–º –≤—ã—à–µ —Ç–∏—Ä, —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ –∏ –æ–ø—ã—Ç–Ω–µ–µ –∏–≥—Ä–æ–∫.</p>
      <ul>
        <li><b>–¢–∏—Ä 1</b> ‚Äî –¢–æ–ø–æ–≤—ã–µ –∏–≥—Ä–æ–∫–∏</li>
        <li><b>–¢–∏—Ä 2‚Äì4</b> ‚Äî –°—Ä–µ–¥–Ω–∏–µ –∏–≥—Ä–æ–∫–∏</li>
        <li><b>–¢–∏—Ä 5</b> ‚Äî –ù–æ–≤–∏—á–∫–∏ –∏ —Å–∞–º—ã–µ –Ω–∏–∑–∫–∏–µ –ø–æ —É—Ä–æ–≤–Ω—é</li>
      </ul>
      <p>
        <b>–¢–∏–ø –Ω–∏–∫–∞:</b><br>
        <span class="ht-demo">HT</span> ‚Äî <b>HT (High Tier)</b>, —Å–∏–ª—å–Ω–µ–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤.<br>
        <span class="lt-demo">LT</span> ‚Äî <b>LT (Low Tier)</b>, –±–æ–ª–µ–µ —Å–ª–∞–±—ã–π –∏–≥—Ä–æ–∫.<br>
      </p>
      <p style="margin-top:18px">
        –¢–∏—Ä–¢–µ—Å—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –ø–æ–Ω—è—Ç—å, –∏–≥—Ä–æ–∫ —Å–∏–ª—ë–Ω, –∞ —Ç–∞–∫ –∂–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ª–∏—á–Ω—ã–º –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º.
      </p>
    </div>
  </div>
  <div class="copyright">
    ¬©Ô∏è EzCargo, 2025
  </div>
  <div class="visitor-counter">
    <span class="visitor-icon">üëÅÔ∏è</span>
    <span id="visitor-count">0</span>
  </div>


  <div class="container">
    <header>
        <h1>
        <img src="sword.gif" alt="–ù–µ–∑–µ—Ä–∏—Ç–æ–≤—ã–π –º–µ—á" style="height:1.3em;vertical-align:middle;margin-right:10px;">
        –¢–∏—Ä-–ª–∏—Å—Ç –∏–≥—Ä–æ–∫–æ–≤
        <img src="sword1.gif" alt="–ê–ª–º–∞–∑–Ω—ã–π –º–µ—á" style="height:1.3em;vertical-align:middle;margin-left:10px;transform:scaleX(-1);">
        </h1>
      <div class="game-modes" style="display:flex;justify-content:center;gap:12px;">
        <button id="kitpvp-btn" class="mode-btn active" onclick="switchGameTab('kitpvp')">KitPVP</button>
        <button id="nezerpot-btn" class="mode-btn" onclick="switchGameTab('nezerpot')">NethPot</button>
      </div>
    </header>
    <div class="game-tab-content active" id="tierlist-kitpvp">
      <div class="tier-container">
        <div class="tier tier-1">
          <div class="tier-header">
            <span class="tier-label">
              <svg class="cup-icon" width="22" height="22" viewBox="0 0 24 12">
                <path fill="#FFD700" d="M18 6V5a3 3 0 0 0-6 0v1H6v2h1v3a7 7 0 0 0 14 0V8h1V6zM6 8h2V6h8v2h2v1H6zm7 2h-2v-1h2zm-1 9c-1.1 0-2-.9-2-2h4a2 2 0 0 1-2 2z"/>
              </svg>
              Tier 1
            </span>
          </div>
          <div class="players-list" id="kitpvp-tier1"></div>
        </div>
        <div class="tier tier-2">
          <div class="tier-header">
            <span class="tier-label">
              <svg class="cup-icon" width="22" height="22" viewBox="0 0 24 12">
                <path fill="#C0C0C0" d="M18 6V5a3 3 0 0 0-6 0v1H6v2h1v3a7 7 0 0 0 14 0V8h1V6zM6 8h2V6h8v2h2v1H6zm7 2h-2v-1h2zm-1 9c-1.1 0-2-.9-2-2h4a2 2 0 0 1-2 2z"/>
              </svg>
              Tier 2
            </span>
          </div>
          <div class="players-list" id="kitpvp-tier2"></div>
        </div>
        <div class="tier tier-3">
          <div class="tier-header">
            <span class="tier-label">
              <svg class="cup-icon" width="22" height="22" viewBox="0 0 24 12">
                <path fill="#cd7f32" d="M18 6V5a3 3 0 0 0-6 0v1H6v2h1v3a7 7 0 0 0 14 0V8h1V6zM6 8h2V6h8v2h2v1H6zm7 2h-2v-1h2zm-1 9c-1.1 0-2-.9-2-2h4a2 2 0 0 1-2 2z"/>
              </svg>
              Tier 3
            </span>
          </div>
          <div class="players-list" id="kitpvp-tier3"></div>
        </div>
        <div class="tier tier-4"><div class="tier-header"><span class="tier-label">Tier 4</span></div><div class="players-list" id="kitpvp-tier4"></div></div>
        <div class="tier tier-5"><div class="tier-header"><span class="tier-label">Tier 5</span></div><div class="players-list" id="kitpvp-tier5"></div></div>
      </div>
      <div id="kitpvp-form" class="admin-only-form" style="display:none;">
        <select id="kitpvp-player-type" class="player-type-select">
          <option value="high">High</option>
          <option value="low">Low</option>
        </select>
        <input id="kitpvp-player-name" class="player-input" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞"/>
        <select id="kitpvp-player-tier" class="player-select">
          <option value="1">Tier 1</option>
          <option value="2">Tier 2</option>
          <option value="3">Tier 3</option>
          <option value="4">Tier 4</option>
          <option value="5">Tier 5</option>
        </select>
        <button id="kitpvp-add-btn" onclick="addPlayer('kitpvp')">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
    <div class="game-tab-content" id="tierlist-nezerpot">
      <div class="tier-container">
        <div class="tier tier-1">
          <div class="tier-header">
            <span class="tier-label">
              <svg class="cup-icon" width="22" height="22" viewBox="0 0 24 12">
                <path fill="#FFD700" d="M18 6V5a3 3 0 0 0-6 0v1H6v2h1v3a7 7 0 0 0 14 0V8h1V6zM6 8h2V6h8v2h2v1H6zm7 2h-2v-1h2zm-1 9c-1.1 0-2-.9-2-2h4a2 2 0 0 1-2 2z"/>
              </svg>
              Tier 1
            </span>
          </div>
          <div class="players-list" id="nezerpot-tier1"></div>
        </div>
        <div class="tier tier-2">
          <div class="tier-header">
            <span class="tier-label">
              <svg class="cup-icon" width="22" height="22" viewBox="0 0 24 12">
                <path fill="#C0C0C0" d="M18 6V5a3 3 0 0 0-6 0v1H6v2h1v3a7 7 0 0 0 14 0V8h1V6zM6 8h2V6h8v2h2v1H6zm7 2h-2v-1h2zm-1 9c-1.1 0-2-.9-2-2h4a2 2 0 0 1-2 2z"/>
              </svg>
              Tier 2
            </span>
          </div>
          <div class="players-list" id="nezerpot-tier2"></div>
        </div>
        <div class="tier tier-3">
          <div class="tier-header">
            <span class="tier-label">
              <svg class="cup-icon" width="22" height="22" viewBox="0 0 24 12">
                <path fill="#cd7f32" d="M18 6V5a3 3 0 0 0-6 0v1H6v2h1v3a7 7 0 0 0 14 0V8h1V6zM6 8h2V6h8v2h2v1H6zm7 2h-2v-1h2zm-1 9c-1.1 0-2-.9-2-2h4a2 2 0 0 1-2 2z"/>
              </svg>
              Tier 3
            </span>
          </div>
          <div class="players-list" id="nezerpot-tier3"></div>
        </div>
        <div class="tier tier-4"><div class="tier-header"><span class="tier-label">Tier 4</span></div><div class="players-list" id="nezerpot-tier4"></div></div>
        <div class="tier tier-5"><div class="tier-header"><span class="tier-label">Tier 5</span></div><div class="players-list" id="nezerpot-tier5"></div></div>
      </div>
      <div id="nezerpot-form" class="admin-only-form" style="display:none;">
        <select id="nezerpot-player-type" class="player-type-select">
          <option value="high">High</option>
          <option value="low">Low</option>
        </select>
        <input id="nezerpot-player-name" class="player-input" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞"/>
        <select id="nezerpot-player-tier" class="player-select">
          <option value="1">Tier 1</option>
          <option value="2">Tier 2</option>
          <option value="3">Tier 3</option>
          <option value="4">Tier 4</option>
          <option value="5">Tier 5</option>
        </select>
        <button id="nezerpot-add-btn" onclick="addPlayer('nezerpot')">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyAXz5odCHUE3-guCR-a3KcxWYINK2fgZD4",
  authDomain: "ewtiers.firebaseapp.com",
  projectId: "ewtiers",
  storageBucket: "ewtiers.appspot.com",
  messagingSenderId: "3653761892",
  appId: "1:3653761892:web:432b3b7922fd693c291871",
  measurementId: "G-Z5JF67WQ8K"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);


const ADMIN_PASSWORD_HASH = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9";
let isAdmin = false;
if (localStorage.getItem('isAdmin') === '1') isAdmin = true;
let currentTab = 'kitpvp';
let playersKitpvpLast = [];
let playersNezerpotLast = [];


let draggedName = null, draggedFromTier = null, draggedType = null, draggedId = null;


function updateAddForms() {
  document.getElementById('kitpvp-form').style.display = isAdmin ? '' : 'none';
  document.getElementById('nezerpot-form').style.display = isAdmin ? '' : 'none';
}
function updateAuthUI() {
  document.getElementById('auth-indicator').innerHTML =
    isAdmin ? '<span class="dot" style="background:#4ecdc4"></span> –ê–¥–º–∏–Ω' : '<span class="dot"></span> –ì–æ—Å—Ç—å';
  document.getElementById('auth-btn').textContent = isAdmin ? '–í—ã–π—Ç–∏' : '–í–æ–π—Ç–∏';
  document.getElementById('auth-btn').onclick = isAdmin ? logout : showAuthModal;
}
function switchGameTab(tab) {
  if(tab === currentTab) return;
  document.getElementById('tierlist-' + currentTab).classList.remove('active');
  document.getElementById(tab + '-btn').classList.add('active');
  document.getElementById(currentTab + '-btn').classList.remove('active');
  document.getElementById('tierlist-' + tab).classList.add('active');
  currentTab = tab;
  if (tab === 'kitpvp') render('kitpvp', playersKitpvpLast);
  else if (tab === 'nezerpot') render('nezerpot', playersNezerpotLast);
}
window.switchGameTab = switchGameTab;


function subscribePlayers(tab, callback) {
  onSnapshot(collection(db, tab), (snapshot) => {
    let obj = {"1":[], "2":[], "3":[], "4":[], "5":[]};
    snapshot.forEach(docSnap => {
      const d = docSnap.data();
      let t = (typeof d.tier === "string") ? d.tier : d.tier.toString();
      obj[t] && obj[t].push({name:d.name, type:d.type, id:docSnap.id});
    });
    let playersByTier = [undefined, obj["1"], obj["2"], obj["3"], obj["4"], obj["5"]];
    callback(playersByTier);
  });
}
async function addPlayerToBase(tab, name, tier, type) {
  await addDoc(collection(db, tab), { name, tier, type });
}
async function deletePlayerFromBase(tab, id) {
  await deleteDoc(doc(db, tab, id));
}
function render(tab, playersTab) {
  for(let tier=1;tier<=5;tier++) {
    let pArr = playersTab[tier] || [];
    let sortedArr = (pArr || []).filter(p => p && p.name).sort((a, b) => {
      if (a.type !== b.type) return a.type === 'high' ? -1 : 1;
      return a.name.localeCompare(b.name, 'ru', {sensitivity: 'base'});
    });
    document.getElementById(tab + '-tier' + tier).innerHTML = sortedArr
    .map(p =>
      `<div class="player ${p.type}-tier" draggable="${isAdmin}" data-name="${p.name}" data-type="${p.type}" data-id="${p.id}" >
        ${p.type === 'high' ? 'HT' : 'LT'} | ${p.name}
      </div>`
    ).join('');
  }
  updateAddForms();
  updateAuthUI();
  enableDnD(tab, playersTab);
  disableDnDForGuests();
  document.body.classList.toggle('admin-mode', isAdmin);
}
function enableDnD(tab, playersTab) {
  let droppedInTier = false;
  document.querySelectorAll('.player').forEach(playerEl => {
    playerEl.setAttribute('draggable', isAdmin ? 'true' : 'false');
    playerEl.ondragstart = null;
    playerEl.ondragend = null;
  });
  document.querySelectorAll('.players-list').forEach(listEl=>{
    listEl.ondragover = null;
    listEl.ondrop = null;
    listEl.ondragenter = null;
    listEl.ondragleave = null;
    listEl.parentNode.classList.remove('drag-over');
  });
  document.body.ondragover = null;
  document.body.ondrop = null;
  if (!isAdmin) return;
  document.querySelectorAll('.player').forEach(playerEl => {
    playerEl.ondragstart = function(e) {
      draggedName = this.getAttribute('data-name');
      draggedType = this.getAttribute('data-type');
      draggedId = this.getAttribute('data-id');
      let matchTier = this.parentElement.id.match(/(kitpvp|nezerpot)-tier(\d)/);
      if (matchTier) draggedFromTier = [matchTier[1], matchTier[2]];
      setTimeout(()=>{ this.classList.add('dragging'); },0);
      droppedInTier = false;
    };
    playerEl.ondragend = function(e) {
      this.classList.remove('dragging');
      if (draggedName && draggedType && draggedFromTier && !droppedInTier) {
        let [tab, tier] = draggedFromTier;
        if (draggedId) deletePlayerFromBase(tab, draggedId);
      }
      draggedName = null; draggedType = null; draggedFromTier = null; draggedId = null; droppedInTier = false;
    };
  });
  document.querySelectorAll('.players-list').forEach(listEl=>{
    listEl.ondragover = function(e) {
      e.preventDefault();
      if (!isAdmin) return;
      this.parentNode.classList.add('drag-over');
    };
    listEl.ondragleave = function(e) {
      this.parentNode.classList.remove('drag-over');
    };
    listEl.ondrop = function(e) {
      e.preventDefault();
      this.parentNode.classList.remove('drag-over');
      droppedInTier = true;
      if (!draggedName || !draggedType || !draggedFromTier) return;
      let matchTo = this.id.match(/(kitpvp|nezerpot)-tier(\d)/);
      let toTab = matchTo[1], toTier = matchTo[2];
      let [fromTab, fromTier] = draggedFromTier;
      if (toTab !== fromTab) return;
      if (fromTier === toTier) return;
      if (draggedId) deletePlayerFromBase(toTab, draggedId);
      addPlayerToBase(toTab, draggedName, toTier, draggedType);
    }
  });
  document.body.ondragover = function(e){ e.preventDefault(); };
  document.body.ondrop = function(e) {
    if (!e.target.closest('.tier')) droppedInTier = false;
  };
}
function disableDnDForGuests() {
  if (!isAdmin) {
    document.querySelectorAll('.player').forEach(playerEl => {
      playerEl.removeAttribute('draggable');
      playerEl.ondragstart = null;
      playerEl.ondragend = null;
    });
    document.querySelectorAll('.players-list').forEach(listEl=>{
      listEl.ondragover = null;
      listEl.ondrop = null;
      listEl.ondragenter = null;
      listEl.ondragleave = null;
      listEl.parentNode.classList.remove('drag-over');
    });
    document.body.ondragover = null;
    document.body.ondrop = null;
  }
}
window.addPlayer = function(tab) {
  if (!isAdmin) return;
  let name = document.getElementById(tab+'-player-name').value.trim();
  let tier = document.getElementById(tab+'-player-tier').value;
  let type = document.getElementById(tab+'-player-type').value;
  if(!name) return;
  addPlayerToBase(tab, name, tier, type);
  document.getElementById(tab+'-player-name').value = '';
};
window.checkPassword = async function() {
  const pass = document.getElementById('auth-password').value;
  const hash = await hashPassword(pass);
  if(hash === ADMIN_PASSWORD_HASH) {
    isAdmin = true;
    localStorage.setItem('isAdmin', '1');
    document.getElementById('auth-modal').style.display = 'none';
    updateAddForms(); updateAuthUI();
  } else {
    document.getElementById('auth-error').textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å";
  }
};
function logout() {
  isAdmin = false;
  localStorage.removeItem('isAdmin');
  updateAddForms(); updateAuthUI();
}
window.logout = logout;
window.showAuthModal = function() {
  document.getElementById('auth-modal').style.display = 'flex';
  document.getElementById('auth-password').value = "";
  document.getElementById('auth-error').textContent = "";
};
async function hashPassword(password) {
  const encoder = new TextEncoder();
  const data = encoder.encode(password);
  const hash = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
}
document.addEventListener('click', function(e) {
  if (e.target === document.getElementById('auth-modal'))
    document.getElementById('auth-modal').style.display = "none";
});
document.addEventListener('keydown', function(e) {
  if (
    document.getElementById('auth-modal').style.display !== "none" &&
    (e.key === "Enter" || e.keyCode === 13)
  ) {
    checkPassword();
  }
});
document.addEventListener('DOMContentLoaded', function() {
  subscribePlayers('kitpvp', function(playersKitpvp) {
    playersKitpvpLast = playersKitpvp;
    if (currentTab === 'kitpvp') render('kitpvp', playersKitpvp);
  });
  subscribePlayers('nezerpot', function(playersNezerpot) {
    playersNezerpotLast = playersNezerpot;
    if (currentTab === 'nezerpot') render('nezerpot', playersNezerpot);
  });
  const address = document.getElementById('copy-address');
  if(address) {
    address.addEventListener('click', function() {
      navigator.clipboard.writeText(address.textContent);
      address.textContent = "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
      setTimeout(() => address.textContent = "play.envyworld.gg", 1200);
    });
  }
  const infoBtn = document.getElementById('show-info-btn');
  const infoPanel = document.getElementById('info-panel');
  const closeBtn = document.getElementById('close-info-btn');
  if (infoBtn && infoPanel && closeBtn) {
    infoBtn.onclick = () => { infoPanel.style.display = 'block'; };
    closeBtn.onclick = () => { infoPanel.style.display = 'none'; };
    document.addEventListener('click', function(e) {
      if (infoPanel.style.display === 'block' &&
          !infoPanel.contains(e.target) &&
          e.target !== infoBtn) {
        infoPanel.style.display = 'none';
      }
    });
  }
  function initVisitorCounter() {
    const hasVisited = sessionStorage.getItem('hasVisited');
    if (!hasVisited) {
      sessionStorage.setItem('hasVisited', 'true');
      addDoc(collection(db, 'visitors'), {
        timestamp: new Date(),
        userAgent: navigator.userAgent.substring(0, 100)
      }).catch(console.error);
    }
    onSnapshot(collection(db, 'visitors'), (snapshot) => {
      document.getElementById('visitor-count').textContent = snapshot.size;
    });
  }
  initVisitorCounter();
  document.body.addEventListener('click', function(e) {
    if (e.target.classList.contains('player')) {
      const name = e.target.getAttribute('data-name');
      if (name) {
        navigator.clipboard.writeText(name);
      }
    }
  });
});
</script>
</body>
</html>
